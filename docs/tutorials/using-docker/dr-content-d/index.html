<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.36" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />

    <title>Jiffy with Kubernetes :: Jiffy Services Generator</title>
    
    
    <link href="/jiffy/css/nucleus.css?1530805896" rel="stylesheet">
    <link href="/jiffy/css/font-awesome.min.css?1530805896" rel="stylesheet">
    <link href="/jiffy/css/hybrid.css?1530805896" rel="stylesheet">
    <link href="/jiffy/css/featherlight.min.css?1530805896" rel="stylesheet">
    <link href="/jiffy/css/perfect-scrollbar.min.css?1530805896" rel="stylesheet">
    <link href="/jiffy/css/auto-complete.css?1530805896" rel="stylesheet">
    <link href="/jiffy/css/theme.css?1530805896" rel="stylesheet">
    <link href="/jiffy/css/hugo-theme.css?1530805896" rel="stylesheet">
    
      <link href="/jiffy/css/theme-blue.css?1530805896" rel="stylesheet">
    

    <script src="/jiffy/js/jquery-2.x.min.js?1530805896"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/jiffy/tutorials/using-docker/dr-content-d/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://1414c.github.io/jiffy">
  <svg id="grav-logo" width="100%" height="100%" viewBox="0 0 504 140" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">
    <path d="M235.832,71.564l-7.98,-0.001c-1.213,0.001 -2.197,0.987 -2.197,2.204l0,15.327l-0.158,0.132c-4.696,3.962 -10.634,6.14 -16.719,6.14c-14.356,0 -26.034,-11.68 -26.034,-26.037c0,-14.358 11.678,-26.035 26.034,-26.035c5.582,0 10.919,1.767 15.437,5.113c0.877,0.649 2.093,0.56 2.866,-0.211l5.69,-5.69c0.444,-0.442 0.675,-1.055 0.639,-1.681c-0.034,-0.627 -0.336,-1.206 -0.828,-1.597c-6.76,-5.363 -15.214,-8.314 -23.805,-8.314c-21.18,0 -38.414,17.233 -38.414,38.415c0,21.183 17.234,38.415 38.414,38.415c10.937,0 21.397,-4.705 28.698,-12.914c0.358,-0.403 0.556,-0.921 0.556,-1.46l0,-19.603c0,-1.217 -0.985,-2.203 -2.2,-2.203"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M502.794,34.445c-0.408,-0.616 -1.1,-0.989 -1.838,-0.989l-8.684,0c-0.879,0 -1.673,0.522 -2.022,1.329l-24.483,56.839l-24.92,-56.852c-0.352,-0.799 -1.142,-1.316 -2.012,-1.316l-8.713,0c-0.744,0 -1.44,0.373 -1.843,0.995c-0.408,0.623 -0.476,1.408 -0.174,2.09l30.186,68.858c0.352,0.799 1.143,1.317 2.017,1.317l10.992,0c0.879,0 1.673,-0.527 2.021,-1.329l29.655,-68.861c0.289,-0.68 0.222,-1.461 -0.182,-2.081"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M388.683,34.772c-0.353,-0.798 -1.142,-1.316 -2.017,-1.316l-10.988,0c-0.879,0 -1.673,0.522 -2.021,1.329l-29.655,68.861c-0.294,0.675 -0.226,1.46 0.182,2.077c0.407,0.619 1.096,0.993 1.838,0.993l8.684,0c0.879,0 1.673,-0.526 2.022,-1.329l24.478,-56.842l24.92,56.854c0.353,0.798 1.143,1.317 2.013,1.317l8.717,0c0.744,0 1.44,-0.374 1.843,-0.993c0.408,-0.624 0.471,-1.41 0.174,-2.094l-30.19,-68.857Z"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M309.196,81.525l0.476,-0.229c8.675,-4.191 14.279,-13.087 14.279,-22.667c0,-13.881 -11.295,-25.174 -25.176,-25.174l-31.863,0c-1.214,0 -2.199,0.988 -2.199,2.202l0,68.855c0,1.219 0.985,2.204 2.199,2.204l7.979,0c1.214,0 2.2,-0.985 2.2,-2.204l0,-58.679l21.684,0c7.059,0 12.799,5.739 12.799,12.796c0,5.885 -3.996,10.989 -9.728,12.408c-1.032,0.261 -2.064,0.393 -3.071,0.393l-7.977,0c-0.829,0 -1.585,0.467 -1.959,1.205c-0.378,0.74 -0.305,1.625 0.187,2.296l22.62,30.884c0.412,0.566 1.07,0.901 1.771,0.901l9.915,0c0.827,0 1.587,-0.467 1.96,-1.207c0.378,-0.742 0.302,-1.629 -0.186,-2.296l-15.91,-21.688Z"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M107.191,80.969c-7.255,-4.794 -11.4,-8.845 -15.011,-16.109c-2.47,4.977 -8.236,12.376 -17.962,18.198c-4.856,15.106 -27.954,44.015 -35.43,39.916c-2.213,-1.212 -2.633,-2.808 -2.133,-4.456c0.536,-4.129 9.078,-13.62 9.078,-13.62c0,0 0.18,1.992 2.913,6.187c-3.609,-11.205 5.965,-25.031 8.5,-29.738c3.985,-1.269 4.274,-6.387 4.274,-6.387c0.255,-7.909 -3.278,-13.635 -6.701,-17.059c2.459,3.002 3.255,7.539 3.372,11.694l0,0.023c0.012,0.469 0.012,0.93 0.011,1.39c-0.117,3.439 -1.157,8.19 -3.383,8.19l0.006,0.03c-2.289,-0.098 -5.115,0.391 -7.639,1.18l-5.582,1.334c0,0 2.977,-0.136 4.584,1.252c-1.79,2.915 -5.769,6.533 -10.206,8.588c-6.457,2.995 -8.312,-2.964 -5.034,-6.838c0.805,-0.946 1.618,-1.745 2.387,-2.399c-0.495,-0.513 -0.807,-1.198 -0.889,-2.068c-0.001,-0.005 -0.004,-0.009 -0.005,-0.013c-0.45,-1.977 -0.202,-4.543 2.596,-8.623c0.551,-0.863 1.214,-1.748 2.007,-2.647c0.025,-0.031 0.046,-0.059 0.072,-0.089c0.034,-0.042 0.072,-0.08 0.108,-0.121c0.02,-0.023 0.039,-0.045 0.059,-0.068c0.2,-0.228 0.413,-0.45 0.639,-0.663c3.334,-3.414 8.599,-6.966 16.897,-10.152c9.675,-14.223 13.219,-16.89 13.219,-16.89c1.071,-1.096 2.943,-2.458 3.632,-2.805c-5.053,-8.781 -6.074,-21.158 -4.75,-24.493c-0.107,0.18 -0.206,0.365 -0.287,0.556c0.49,-1.143 0.819,-1.509 1.328,-2.111c1.381,-1.632 6.058,-2.488 7.737,0.971c0.895,1.844 1.063,4.232 1.034,6.023c-3.704,-0.193 -7.063,4.036 -7.063,4.036c0,0 3.067,-1.448 6.879,-1.473c0,0 1.015,0.883 2.283,2.542c-1.712,3.213 -4.524,10.021 -2.488,17.168c0.338,1.408 0.849,2.619 1.483,3.648c0.024,0.045 0.044,0.089 0.069,0.135c0.051,0.066 0.096,0.122 0.144,0.183c3.368,5.072 9.542,5.665 9.542,5.665c-2.906,-1.45 -5.274,-3.76 -6.816,-6.56c-0.8,-1.498 -1.291,-2.762 -1.592,-3.761c-1.636,-6.313 0.771,-9.999 2.149,-12.471c3.17,-4.917 8.944,-7.893 15.151,-7.185c8.712,0.995 14.968,8.862 13.973,17.571c-0.608,5.321 -3.781,9.723 -8.142,12.117c1.049,2.839 -0.073,6.28 -0.073,6.28c2.642,3.323 2.758,5.238 2.667,7.017c-3.357,-0.565 -6.618,1.701 -6.618,1.701c0,0 6.476,-1.546 10.238,1.81c2.446,2.631 4.078,5.009 5.051,6.766c1.393,2.505 7.859,2.683 7.123,7.188c-0.737,4.499 -5.669,4.542 -13.401,-0.56M69.571,0c-38.424,0 -69.571,31.148 -69.571,69.567c0,38.422 31.147,69.573 69.571,69.573c38.42,0 69.568,-31.151 69.568,-69.573c0,-38.42 -31.148,-69.567 -69.568,-69.567"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M73.796,51.693c0.813,-0.814 0.813,-2.134 0,-2.947c-0.815,-0.814 -2.133,-0.814 -2.947,0c-0.815,0.813 -0.815,2.133 0,2.947c0.814,0.813 2.132,0.813 2.947,0" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M66.445,53.149c-0.814,0.813 -0.814,2.133 0,2.947c0.813,0.814 2.133,0.814 2.947,0c0.813,-0.814 0.813,-2.134 0,-2.947c-0.814,-0.813 -2.134,-0.813 -2.947,0" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M79.231,54.233c-1.274,-1.274 -3.339,-1.272 -4.611,0l-2.713,2.712c-1.274,1.275 -1.274,3.339 0,4.612l2.978,2.978c1.274,1.275 3.338,1.274 4.611,0l2.712,-2.712c1.274,-1.274 1.274,-3.339 0,-4.612l-2.977,-2.978Z" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M95.759,41.445c-2.151,-2.578 1.869,-7.257 4.391,-4.463c4.645,5.148 -2.237,7.041 -4.391,4.463M105.004,44.132c3.442,-6.553 -1.427,-10.381 -4.773,-13.523c-5.36,-5.039 -10.706,-7.217 -16.811,-0.241c-6.102,6.977 -2.226,15.068 3.356,19.061c5.584,3.994 14.782,1.255 18.228,-5.297"
      style="fill:#000;fill-rule:nonzero;"></path>
  </svg>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/jiffy/js/lunr.min.js?1530805896"></script>
<script type="text/javascript" src="/jiffy/js/auto-complete.js?1530805896"></script>
<script type="text/javascript">
    
        var baseurl = '\/jiffy\/';
    
</script>
<script type="text/javascript" src="/jiffy/js/search.js?1530805896"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/jiffy/overview/" title="Jiffy Overview" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/overview/">
          <i class='fa fa-github'></i> Jiffy Overview
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/overview/ov-content-a/" title="What is Jiffy?" class="dd-item ">
        <a href="/jiffy/overview/ov-content-a/">
        What is Jiffy?
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/overview/ov-content-b/" title="Jiffy Application Overview" class="dd-item ">
        <a href="/jiffy/overview/ov-content-b/">
        Jiffy Application Overview
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/overview/ov-content-c/" title="Jiffy Application Structure" class="dd-item ">
        <a href="/jiffy/overview/ov-content-c/">
        Jiffy Application Structure
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/overview/ov-content-d/" title="Jiffy Application Architecture" class="dd-item ">
        <a href="/jiffy/overview/ov-content-d/">
        Jiffy Application Architecture
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/overview/ov-content-e/" title="Jiffy Development Steps" class="dd-item ">
        <a href="/jiffy/overview/ov-content-e/">
        Jiffy Development Steps
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/jiffy/getting-started/" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/getting-started/">
          <i class='fa fa-github'></i> Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/gs-content-a/" title="Go Environment" class="dd-item ">
        <a href="/jiffy/getting-started/gs-content-a/">
        Go Environment
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/gs-content-b/" title="Installing Jiffy" class="dd-item ">
        <a href="/jiffy/getting-started/gs-content-b/">
        Installing Jiffy
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/gs-content-c/" title="Let&#39;s Build Something" class="dd-item ">
        <a href="/jiffy/getting-started/gs-content-c/">
        Let&#39;s Build Something
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/gs-content-d/" title="Let&#39;s Run Something" class="dd-item ">
        <a href="/jiffy/getting-started/gs-content-d/">
        Let&#39;s Run Something
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/jiffy/getting-started/level-two/" title="Let&#39;s Test Something" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/getting-started/level-two/">
          Let&#39;s Test Something
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/level-two/l2-content-a/" title="Login" class="dd-item ">
        <a href="/jiffy/getting-started/level-two/l2-content-a/">
        Login
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/level-two/l2-content-b/" title="Create a Person" class="dd-item ">
        <a href="/jiffy/getting-started/level-two/l2-content-b/">
        Create a Person
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/level-two/l2-content-c/" title="Create Another Person" class="dd-item ">
        <a href="/jiffy/getting-started/level-two/l2-content-c/">
        Create Another Person
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/level-two/l2-content-d/" title="Get Some Persons" class="dd-item ">
        <a href="/jiffy/getting-started/level-two/l2-content-d/">
        Get Some Persons
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/level-two/l2-content-e/" title="Get a Person" class="dd-item ">
        <a href="/jiffy/getting-started/level-two/l2-content-e/">
        Get a Person
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/level-two/l2-content-f/" title="Update a Person" class="dd-item ">
        <a href="/jiffy/getting-started/level-two/l2-content-f/">
        Update a Person
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/level-two/l2-content-g/" title="Get Persons With Restrictions" class="dd-item ">
        <a href="/jiffy/getting-started/level-two/l2-content-g/">
        Get Persons With Restrictions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/level-two/l2-content-h/" title="Delete a Person" class="dd-item ">
        <a href="/jiffy/getting-started/level-two/l2-content-h/">
        Delete a Person
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/getting-started/level-two/l2-content-i/" title="Next Steps" class="dd-item ">
        <a href="/jiffy/getting-started/level-two/l2-content-i/">
        Next Steps
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/jiffy/installation/" title="Jiffy Installation" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/installation/">
          <i class='fa fa-github'></i> Jiffy Installation
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/installation/in-content-a/" title="Jiffy Dependencies" class="dd-item ">
        <a href="/jiffy/installation/in-content-a/">
        Jiffy Dependencies
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/installation/in-content-b/" title="Jiffy Installation" class="dd-item ">
        <a href="/jiffy/installation/in-content-b/">
        Jiffy Installation
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/jiffy/execution/" title="Jiffy Execution" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/execution/">
          <i class='fa fa-github'></i> Jiffy Execution
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/execution/ex-content-a/" title="Running Jiffy" class="dd-item ">
        <a href="/jiffy/execution/ex-content-a/">
        Running Jiffy
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/execution/ex-content-b/" title="Jiffy Execution Flags" class="dd-item ">
        <a href="/jiffy/execution/ex-content-b/">
        Jiffy Execution Flags
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/jiffy/models/" title="Model Maintenance" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/models/">
          <i class='fa fa-github'></i> Model Maintenance
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/models/mo-content-a/" title="Model Overview" class="dd-item ">
        <a href="/jiffy/models/mo-content-a/">
        Model Overview
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/models/mo-content-b/" title="Simple Two Entity Model" class="dd-item ">
        <a href="/jiffy/models/mo-content-b/">
        Simple Two Entity Model
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/models/mo-content-c/" title="Model with Composite Index" class="dd-item ">
        <a href="/jiffy/models/mo-content-c/">
        Model with Composite Index
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/models/mo-content-d/" title="Entity Relations" class="dd-item ">
        <a href="/jiffy/models/mo-content-d/">
        Entity Relations
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/jiffy/generation/" title="Generation Reference" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/generation/">
          <i class='fa fa-github'></i> Generation Reference
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/generation/gn-content-a/" title="Generation Overview" class="dd-item ">
        <a href="/jiffy/generation/gn-content-a/">
        Generation Overview
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/generation/gn-content-b/" title="Generated &#39;application&#39; Folder" class="dd-item ">
        <a href="/jiffy/generation/gn-content-b/">
        Generated &#39;application&#39; Folder
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/generation/gn-content-c/" title="Generated &#39;appobj&#39; Folder" class="dd-item ">
        <a href="/jiffy/generation/gn-content-c/">
        Generated &#39;appobj&#39; Folder
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/generation/gn-content-d/" title="Generated &#39;controllers&#39; Folder" class="dd-item ">
        <a href="/jiffy/generation/gn-content-d/">
        Generated &#39;controllers&#39; Folder
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/generation/gn-content-e/" title="Generated &#39;models&#39; Folder" class="dd-item ">
        <a href="/jiffy/generation/gn-content-e/">
        Generated &#39;models&#39; Folder
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/generation/gn-content-f/" title="Generated &#39;middleware&#39; Folder" class="dd-item ">
        <a href="/jiffy/generation/gn-content-f/">
        Generated &#39;middleware&#39; Folder
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/generation/gn-content-g/" title="Generated &#39;jwtkeys&#39; Folder" class="dd-item ">
        <a href="/jiffy/generation/gn-content-g/">
        Generated &#39;jwtkeys&#39; Folder
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/generation/gn-content-h/" title="Other Generated Folders" class="dd-item ">
        <a href="/jiffy/generation/gn-content-h/">
        Other Generated Folders
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/jiffy/extensionpoints/" title="Extension Points" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/extensionpoints/">
          <i class='fa fa-github'></i> Extension Points
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/extensionpoints/ep-content-a/" title="Extension Point Overview" class="dd-item ">
        <a href="/jiffy/extensionpoints/ep-content-a/">
        Extension Point Overview
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/extensionpoints/ep-content-b/" title="Controller Extension Points" class="dd-item ">
        <a href="/jiffy/extensionpoints/ep-content-b/">
        Controller Extension Points
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/extensionpoints/ep-content-c/" title="Model Extension Points" class="dd-item ">
        <a href="/jiffy/extensionpoints/ep-content-c/">
        Model Extension Points
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/jiffy/accesscontrol/" title="Access Control" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/accesscontrol/">
          <i class='fa fa-github'></i> Access Control
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/accesscontrol/ac-content-a/" title="Access Control Overview" class="dd-item ">
        <a href="/jiffy/accesscontrol/ac-content-a/">
        Access Control Overview
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/accesscontrol/ac-content-b/" title="Authorizations" class="dd-item ">
        <a href="/jiffy/accesscontrol/ac-content-b/">
        Authorizations
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/accesscontrol/ac-content-c/" title="Access Revocation and Renewal" class="dd-item ">
        <a href="/jiffy/accesscontrol/ac-content-c/">
        Access Revocation and Renewal
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/accesscontrol/ac-content-d/" title="Using External Identity Providers" class="dd-item ">
        <a href="/jiffy/accesscontrol/ac-content-d/">
        Using External Identity Providers
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/jiffy/interprocess/" title="Interprocess Communication" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/interprocess/">
          <i class='fa fa-github'></i> Interprocess Communication
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/interprocess/ip-content-a/" title="Group Membership Overview" class="dd-item ">
        <a href="/jiffy/interprocess/ip-content-a/">
        Group Membership Overview
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/interprocess/ip-content-b/" title="Failure Detector" class="dd-item ">
        <a href="/jiffy/interprocess/ip-content-b/">
        Failure Detector
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/interprocess/ip-content-c/" title="Process Startup / Join" class="dd-item ">
        <a href="/jiffy/interprocess/ip-content-c/">
        Process Startup / Join
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/jiffy/usage/" title="Testing and Deployment" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/usage/">
          <i class='fa fa-github'></i> Testing and Deployment
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/jiffy/usage/deployment/" title="Deployment Overview" class="dd-item 
        
        
        
        ">
      <a href="/jiffy/usage/deployment/">
          Deployment Overview
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/jiffy/tutorials/" title="Jiffy Tutorials" class="dd-item 
        parent
        
        
        ">
      <a href="/jiffy/tutorials/">
          <i class='fa fa-github'></i> Jiffy Tutorials
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/tutorials/tt-content-a/" title="Hand Coding a Custom Join" class="dd-item ">
        <a href="/jiffy/tutorials/tt-content-a/">
        Hand Coding a Custom Join
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/tutorials/tt-content-b/" title="Dealing with mixed/multipart" class="dd-item ">
        <a href="/jiffy/tutorials/tt-content-b/">
        Dealing with mixed/multipart
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/jiffy/tutorials/using-docker/" title="Using Docker" class="dd-item 
        parent
        
        
        ">
      <a href="/jiffy/tutorials/using-docker/">
          <i class='fa fa-github'></i> Using Docker
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/jiffy/tutorials/using-docker/dr-content-a/" title="Jiffy with Docker and SQLite" class="dd-item ">
        <a href="/jiffy/tutorials/using-docker/dr-content-a/">
        Jiffy with Docker and SQLite
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/tutorials/using-docker/dr-content-b/" title="Jiffy with Docker and External PostgreSQL" class="dd-item ">
        <a href="/jiffy/tutorials/using-docker/dr-content-b/">
        Jiffy with Docker and External PostgreSQL
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/tutorials/using-docker/dr-content-d/" title="Jiffy with Kubernetes" class="dd-item active">
        <a href="/jiffy/tutorials/using-docker/dr-content-d/">
        Jiffy with Kubernetes
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/jiffy/tutorials/using-docker/dr-content-g/" title="Troubleshooting" class="dd-item ">
        <a href="/jiffy/tutorials/using-docker/dr-content-g/">
        Troubleshooting
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/1414C/jiffy/"><i class='fa fa-fw fa-github'></i> Github repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://1414c.github.io/jiffy/showcase"><i class='fa fa-fw fa-camera'></i> Showcases</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://1414c.github.io/jiffy/credits"><i class='fa fa-fw fa-bullhorn'></i> Credits</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/jiffy/'></a> > <a href='/jiffy/tutorials/'>Jiffy Tutorials</a> > <a href='/jiffy/tutorials/using-docker/'>Using Docker</a> > Jiffy with Kubernetes
          
         
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#steps">Steps</a>
<ul>
<li><a href="#verify-jiffy-installation">Verify Jiffy Installation</a></li>
<li><a href="#generate-the-application">Generate the Application</a></li>
<li><a href="#edit-the-application-configuration-file">Edit the Application Configuration File</a>
<ul>
<li><a href="#update-address-keys">Update Address Keys</a></li>
<li><a href="#update-application-s-database-config">Update Application&rsquo;s Database Config</a></li>
<li><a href="#ensure-postgresql-is-available">Ensure PostgreSQL is Available</a></li>
<li><a href="#ensure-that-a-kvs-is-available">Ensure that a KVS is Available</a></li>
</ul></li>
<li><a href="#build-a-static-application-binary-for-alpine-linux">Build a Static Application Binary for Alpine Linux</a>
<ul>
<li><a href="#install-musl-gcc">Install Musl-gcc</a></li>
<li><a href="#build-a-static-application-binary">Build a Static Application Binary</a></li>
<li><a href="#build-a-dynamically-linked-application-binary">Build a Dynamically-Linked Application Binary</a></li>
</ul></li>
<li><a href="#create-a-dockerfile">Create a Dockerfile</a></li>
<li><a href="#create-the-entrypoint-script">Create the Entrypoint Script</a></li>
<li><a href="#build-the-image">Build the Image</a>
<ul>
<li><a href="#view-the-image">View the Image</a></li>
<li><a href="#use-the-image">Use the Image</a></li>
<li><a href="#check-the-container-status">Check the Container Status</a></li>
<li><a href="#ssh-into-the-container">SSH into the Container</a></li>
</ul></li>
<li><a href="#use-the-psql-client-to-connect-to-postgres">Use the psql Client to Connect to Postgres</a></li>
<li><a href="#login-to-the-application">Login to the Application</a></li>
<li><a href="#create-a-library">Create a Library</a></li>
<li><a href="#stop-the-docker-container">Stop the Docker Container</a></li>
</ul></li>
<li><a href="#install-minikube">Install Minikube</a>
<ul>
<li><a href="#verify-minikube-installation">Verify Minikube Installation</a></li>
<li><a href="#open-the-kubernetes-dashboard">Open the Kubernetes Dashboard</a></li>
<li><a href="#deploy-the-application-in-kubernetes">Deploy the Application in Kubernetes</a></li>
<li><a href="#check-the-pod-logs">Check the Pod Logs</a></li>
<li><a href="#scale-the-application-up">Scale the Application Up</a></li>
<li><a href="#expose-the-deployment-via-a-kubernetes-service">Expose the Deployment via a Kubernetes Service</a>
<ul>
<li><a href="#get-deployments">Get Deployments</a></li>
<li><a href="#get-pods">Get Pods</a></li>
<li><a href="#get-kubernetes-services">Get Kubernetes Services</a></li>
<li><a href="#create-a-service-for-the-libappk8-deployment">Create a Service for the <em>libappk8</em> Deployment</a></li>
</ul></li>
<li><a href="#get-the-base-url-for-the-kubernetes-service">Get the Base URL for the Kubernetes Service</a>
<ul>
<li><a href="#get-the-service-base-url-from-the-command-prompt">Get the Service Base URL from the Command-Prompt</a></li>
<li><a href="#get-the-service-base-url-from-the-cluster-config-service-port-mapping">Get the Service Base URL from the Cluster Config / Service Port Mapping</a></li>
<li><a href="#get-the-service-base-url-from-the-kubernetes-dashboard">Get the Service Base URL from the Kubernetes Dashboard</a></li>
</ul></li>
<li><a href="#login-to-the-load-balanced-kubernetes-service">Login to the Load Balanced Kubernetes Service</a></li>
<li><a href="#create-a-library-1">Create a Library</a></li>
<li><a href="#create-a-book">Create a Book</a></li>
<li><a href="#library-tobooks">Library toBooks</a></li>
<li><a href="#book-tolibrary">Book toLibrary</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Jiffy with Kubernetes</h1>
          

        




<h3 id="overview">Overview</h3>

<p>We will create and deploy a sample jiffy application in Kubernetes using the preconfigured <em>minikube</em> cluster.  The containerized jiffy application will be deployed in the Kubernetes cluster and will communicate with a Postgres database and KVS running on the cluster-host&rsquo;s network.  In this example the Postgres database and KVS will not be running in containers.</p>

<p>The goal of this example is to get a feel for Kubernetes deployment of a jiffy-application.  This tutorial should not be considered as a roadmap for productive Kubernetes deployments, but as a starting point for getting a jiffy application running in Kubernetes.</p>

<p>We will see how to deploy the containerized application into a Kubernetes Node, how to view the Pod logs, how to scale the deployment up/down and how to log into a Pod.  For the most part, we will use the Kubernetes <em>minikube</em> default cluster values.</p>

<h3 id="steps">Steps</h3>

<ol>
<li>Verify the Jiffy installation.</li>
<li>Generate a new application using a sample model file from the Jiffy source-tree.</li>
<li>Edit the application&rsquo;s configuration file for Postgres and Docker use.</li>
<li>Statically compile a binary for inclusion in the Docker image.</li>
<li>Write a simple Dockerfile to create a runnable image.</li>
<li>Write a small script to update the image&rsquo;s <em>.dev.config.json</em> file with the container&rsquo;s ipv4 address.</li>
<li>Create a container from the image and start the container.</li>
<li>Test access to the application running in the container using Postman.</li>
<li>Install the <em>minikube</em> Kubernetes cluster.</li>
<li>Create a Kubernetes deployment of the containerized jiffy application.</li>
<li>Expose the jiffy application deployment as a Kubernetes Service.</li>
<li>Detect the IP/port that <em>minikube</em> is using to expose the new Kubernetes Service.</li>
<li>Run some tests against the Kubernetes Deployment of the jiffy application using Postman.</li>
<li>Scale the deployment up and down.</li>
<li>View the logs of the Pods running in the <em>minikube</em> cluster.</li>
<li>Login to a Pod running an instance of the jiffy application and take a look around.</li>
<li>Shutdown the Kubernetes Service.</li>
<li>Remove the Kubernetes Deployment of the jiffy application.</li>
<li>Cleanup the Docker environment.</li>
</ol>

<h4 id="verify-jiffy-installation">Verify Jiffy Installation</h4>

<p>Ensure that Jiffy has been installed on your workstation by following the instructions provided in the <a href="/jiffy/installation">Jiffy Installation</a> section.</p>

<h4 id="generate-the-application">Generate the Application</h4>

<p>We will generate a new application called <em>libappK8</em> from a <a href="https://github.com/1414C/jiffy/blob/master/support/testing_models/hasManyBelongsTo.json">model file</a> that contains a &lsquo;Library&rsquo; and &lsquo;Book&rsquo; entity.  Two relationships are maintained in the model; a Library hasMany Books and a Book belongsTo a specific Library.  An application generated from this model will allow many Jiffy application features to be tested.</p>

<p>Open a terminal window on your workstation and run jiffy using the Library-Book model file to generate the source-code for our test application as follows:</p>

<pre><code class="language-shell">
  jiffy -m $GOPATH/src/github.com/1414C/jiffy/support/testing_models/hasManyBelongsTo.json -p /exp/libappk8

</code></pre>

<p><a href="/jiffy/execution/ex-content-b/#generation-flags">Remember that jiffy&rsquo;s -p flag</a> expects to be provided with an existing path underneath your $GOPATH/src folder.  In the example invocation shown above, jiffy will create the <em>libappk8</em> folder underneath $GOPATH/src/exp/ and then write the generated source-code to this location.</p>

<p>Execution of the generator (jiffy) should result in output similar to:</p>

<pre><code class="language-shell">
Aardvark:jiffy stevem$ jiffy go -m $GOPATH/src/github.com/1414C/jiffy/support/testing_models/hasManyBelongsTo.json -p /exp/libappk8
2018/07/03 21:34:47 generated: /Users/stevem/gowork/src/exp/libappk8/models/librarym.go
2018/07/03 21:34:47 generated: /Users/stevem/gowork/src/exp/libappk8/models/librarym_ext.go
2018/07/03 21:34:47 generated: /Users/stevem/gowork/src/exp/libappk8/controllers/libraryc.go
...
...
...
2018/07/03 21:34:49 executing /usr/local/go/bin/goimports -w /Users/stevem/gowork/src/exp/libappk8/util/strings.go
2018/07/03 21:34:49 executing /usr/local/go/bin/gofmt -w /Users/stevem/gowork/src/exp/libappk8/util/strings.go
2018/07/03 21:34:49 executing /usr/local/go/bin/goimports -w /Users/stevem/gowork/src/exp/libappk8/appobj/appconf.go
2018/07/03 21:34:49 executing /usr/local/go/bin/gofmt -w /Users/stevem/gowork/src/exp/libappk8/appobj/appconf.go
Aardvark:jiffy stevem$

</code></pre>

<p>Your output may look slightly different, particularly the database connection test which will almost certainly fail.  This is nothing to be concerned about, as the generator is attempting to connect to a local Postgres instance using bad credentials.
<br></br></p>

<h4 id="edit-the-application-configuration-file">Edit the Application Configuration File</h4>

<h5 id="update-address-keys">Update Address Keys</h5>

<p>The next step is to edit the generated application&rsquo;s configuration files.  Docker allocates a static ip-address for each container by default, and we will use that address in our application&rsquo;s configuration file.  &lsquo;external_address&rsquo; refers to the address at which the application&rsquo;s end-points will be available, while the &lsquo;internal_address&rsquo; is used for cache updates and interprocess communication over web-socket connections.</p>

<p>Open the generated <em>.dev.config.json</em> file in an editor and update the &lsquo;external_address&rsquo; and &lsquo;internal_address&rsquo; values with &ldquo;xxx.xxx.xxx.xxx:8080&rdquo; and &ldquo;xxx.xxx.xxx.xxx:4444&rdquo; respectively.  Using an illegal ipv4 address as a placeholder/mask ensures that the container will not start in the event that the container&rsquo;s address could not be assigned to the config keys.  When you have finished, save the file after verifying that it looks like this:</p>

<pre><code class="language-json">.dev.config.json

{
    &quot;external_address&quot;: &quot;xxx.xxx.xxx.xxx:8080&quot;,
    &quot;internal_address&quot;: &quot;xxx.xxx.xxx.xxx:4444&quot;,
    &quot;env&quot;: &quot;dev&quot;,
    ...
    ...

}

</code></pre>

<h5 id="update-application-s-database-config">Update Application&rsquo;s Database Config</h5>

<p>Jiffy generates configuration files targeting a Postgres database by default.  Maintain the values in the &lsquo;database&rsquo; block of the *.dev.config.json; file as necessary in order to gain access to your testing database:</p>

<pre><code class="language-json">.dev.config.json

{
    ...
    &quot;database&quot;: {
        &quot;db_dialect&quot;: &quot;postgres&quot;,
        &quot;host&quot;:       &quot;192.168.1.65&quot;,
        &quot;port&quot;:       5432,
        &quot;usr&quot;:        &quot;godev&quot;,
        &quot;password&quot;:   &quot;gogogo123&quot;,
        &quot;name&quot;:       &quot;glrestgen&quot;
    },
    ...
}

</code></pre>

<p>Once the database block in <em>.dev.config.json</em> has been updated, save the file and close the editor.</p>

<h5 id="ensure-postgresql-is-available">Ensure PostgreSQL is Available</h5>

<p>By default, Postgres only allows connections from the localhost (127.0.0.1).  If your Postgres database is running on another machine, you will need to ensure that it allows connections from remote hosts.  A quick web-search will reveal how to maintain Postgres&rsquo;s <em>postgresql.conf</em> and <em>pg_hba.conf</em> files to allow remote connections to the database.  Make sure that you are able to connect to your Postgres database (use <em>psql</em>) from the Docker host environment before continuing.</p>

<h5 id="ensure-that-a-kvs-is-available">Ensure that a KVS is Available</h5>

<p>Sluggo - link to the <em>sluggo</em> setup tutorial?</p>

<p><br></br></p>

<h4 id="build-a-static-application-binary-for-alpine-linux">Build a Static Application Binary for Alpine Linux</h4>

<p>Next, we need to build a static application binary for linux/amd64.  To build the application, a number of dependencies are required as outlined in the <a href="/jiffy/installation/in-content-a/#what-does-jiffy-need-to-run">Jiffy Dependencies</a> section of the documentation.  Check that your build environment contains the correct packages and import any that are missing.</p>

<p>This tutorial uses the popular <a href="https://alpinelinux.org/">Alpine Linux distribution</a> as the basis for the new container image.  Alpine Linux is a small and sparse distribution making it nice for use with containers.  There are a few things to be aware of however&hellip;</p>

<p>Alpine Linux is based on <a href="https://www.musl-libc.org/">lib-musl</a> which means that binaries built by <em>go build</em> must target lib-musl rather than lib-gcc.  The binary resulting from the typical &lsquo;GOOS=linux GOARCH=amd64 go build -o main .&rsquo; command would almost certainly not work on Alpine.  The good news it is quite easy to build with musl-gcc, the bad news is that musl-gcc is available for Linux only.  If you are working on a system in which lib-musl is not supported, you will need to run the <em>go build</em> command in a supported build environment. <a href="https://wiki.musl-libc.org/supported-platforms.html">Most Linux distributions and architectures are supported</a>.</p>

<p>Check if <em>lib-musl</em> has been installed in the build environment by running the <em>which</em> command:</p>

<pre><code class="language-shell">
  which musl-gcc

</code></pre>

<p>If <em>musl-gcc</em> was found in the $PATH, <em>which</em> will return output similar to:</p>

<pre><code class="language-shell">
/usr/bin/musl-gcc

</code></pre>

<p>If <em>musl-gcc</em> was not found, follow the installation instructions below to download and install the required packages.</p>

<h5 id="install-musl-gcc">Install Musl-gcc</h5>

<p>We will go over how to install <em>musl-gcc</em> on a Debian system, but the steps are largely the same for any Linux distribution.  Use your distribution&rsquo;s package manager to install the musl lib, musl development files and musl development tools.  Run the following commands (or their equivalents) in a terminal window on your Linux build system:</p>

<pre><code class="language-shell">
sudo apt-get update
sudo apt-get install musl
sudo apt-get install musl-dev
sudo apt-get install musl-tools

</code></pre>

<p>Check to make sure that <em>musl-gcc</em> is now in the $PATH:</p>

<pre><code class="language-shell">
which musl-gcc

</code></pre>

<h5 id="build-a-static-application-binary">Build a Static Application Binary</h5>

<p>After ensuring that all of the required dependencies have been installed in the build environment, run the following command to build a statically-linked binary called <em>main</em> for the Alpine Linux target OS.  Setting the CC environment variable to point at <em>musl-gcc</em> ensures that the target (executable) will run in the Alpine Linux environment.  Adjust the GOARCH environment variable as necessary:</p>

<pre><code class="language-shell">
CGO=0 GOOS=linux GOARCH=amd64 CC=$(which musl-gcc) go build --ldflags '-w -linkmode external -extldflags &quot;-static&quot;' -a -tags netgo -installsuffix cgo -o main .

</code></pre>

<p>Running <em>go build</em> with CGO=0 and setting the -a flag forces a rebuild without cross-compilation dependencies.  Setting &ndash;ldflags as shown instructs <em>go build</em> to produce a statically linked binary.  Setting the CC environment variable to point at musl-gcc ensures that the target (executable) will run in the Alpine Linux environment.  Once the build has completed, a new &lsquo;main&rsquo; file will have been created.  Check the file via the <em>file</em> command:</p>

<pre><code class="language-shell">
file main

</code></pre>

<p>You should see output similar to:</p>

<pre><code class="language-shell">
main: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, not stripped

</code></pre>

<h5 id="build-a-dynamically-linked-application-binary">Build a Dynamically-Linked Application Binary</h5>

<p>This is optional and will produce a marginally smaller binary.  We will not use a dynamically-linked binary in our image, but have included a suitable <em>go build</em> command for reference purposes.</p>

<pre><code class="language-shell">
CGO=0 GOOS=linux GOARCH=amd64 CC=$(which musl-gcc) go build -a -tags netgo -installsuffix cgo -o main .

</code></pre>

<p>Running <em>go build</em> with CGO=0 and setting the -a flag forces a rebuild without cross-compilation dependencies.  <em>go build</em> produces dynamically-linked binaries by default, so no linker instructions have been provided.  Setting the CC environment variable to point at <em>musl-gcc</em> ensures that the target (executable) will run in the Alpine Linux environment.  Once the build has completed, a new &lsquo;main&rsquo; file will have been created.  Check the file via the <em>file</em> command:</p>

<pre><code class="language-shell">
file main

</code></pre>

<p>You should see output similar to:</p>

<pre><code class="language-shell">
main: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-x86_64.so.1, not stripped

</code></pre>

<p><br></br></p>

<h4 id="create-a-dockerfile">Create a Dockerfile</h4>

<p>Verify that you have Docker installed in your build environment.  The easiest way to do this is to run <em>which docker</em> in a terminal window to ensure the <em>docker</em> application is in the $PATH.  If there is no response, check the $PATH or install Docker following the instructions at <a href="https://www.docker.com/get-docker">www.docker.com</a>.  Verify that the Docker daemon is running by opening a terminal window in your build environment and running the <em>docker ps</em> command.  If Docker is not running, an error message will be displayed.  Start the Docker daemon before continuing.</p>

<p>In order to deploy the compiled application in a Docker container, we need to create a Dockerfile.  The <em>docker build</em> command uses the Dockerfile as a set of instructions when building an image.  As mentioned previously, we will use Alpine Linux as the foundation (base image) for the new Docker container image.  <a href="https://hub.docker.com/_/alpine/">Dockerhub</a> has a number of pre-defined images that are available to be &lsquo;pulled&rsquo; into locally defined custom images.</p>

<p>Create a new file called <em>Dockerfile</em> in the root folder of the pgelibraryapp source-tree and open it in your editor.  Copy the following content into the new Dockerfile.  An effort has been made to briefly describe what each line of the Dockerfile is used for.</p>

<pre><code class="language-Dockerfile">
# use the official docker hub alpine:3.7 base image
FROM alpine:3.7

# set the maintainer information for the new image
LABEL maintainer=&quot;&lt;stevem@1414c.io&gt;&quot;

# add the compiled application binary to the root folder of the new image
ADD main ./

# set permissions on main
RUN /bin/chmod 755 main

# copy the configuration file to the root folder of the new image
COPY .dev.config.json .

# add the entrypoint.sh shell script to the root folder of the new image
ADD docker-entrypoint.sh .

# set widely exectuable permission on the shell-script
RUN /bin/chmod 777 docker-entrypoint.sh

# create a directory in the root folder of the new image to hold the jwt signing keys
RUN mkdir jwtkeys

# copy the jwtkeys folder content into the image's /jwtkeys folder
COPY jwtkeys ./jwtkeys

# set container environment variable $PORT to 8080
ENV PORT 8080

# container will listen on port tcp/8080
EXPOSE 8080

# container will listen on port ws/4444
EXPOSE 4444

# update local package list
RUN apk update

# add unix file command
RUN apk add file

# add openssh-client for connectivity testing
RUN apk add openssh-client

# add the postgresql-client to test connectivity to the db
RUN apk add postgresql-client

ENTRYPOINT [&quot;/docker-entrypoint.sh&quot;]

CMD [&quot;-dev&quot;]

</code></pre>

<p><br></br></p>

<h4 id="create-the-entrypoint-script">Create the Entrypoint Script</h4>

<p>In a previous step <em>.dev.config.json</em> was updated with xxx.xxx.xxx.xxx ipv4 address masks.  In order to replace the masks with the container&rsquo;s ipv4 address, <em>docker run</em> and <em>docker start</em> will execute the <em>docker-entrypoint.sh</em> when running a container instance based on the image definition.  At the moment this is a problem however, as we have not written the script yet.  Create a new file called <em>docker-entrypoint.sh</em> in the root folder of the pgelibraryapp source-tree and open it in your editor.  Copy the following content into the new <em>docker-entrypoint.sh</em> file:</p>

<pre><code class="language-sh">
#!/bin/sh

# get the ipv4 address assigned to eth0
replace=$(ifconfig eth0 | grep &quot;inet addr&quot; | cut -d ':' -f 2 | cut -d ' ' -f 1)

# set a variable with the value we are planning to replace
search=&quot;xxx.xxx.xxx.xxx&quot;

# check that variable replace has something in it
if [ -z &quot;$replace&quot; ]; then
  echo &quot;Did not get an address value for eth0&quot;
elif [ -n &quot;$replace&quot; ]; then
  echo &quot;${replace} found&quot;
# replace all instances of 'xxx.xxx.xxx.xxx' in .dev.config.json
# with the ipv4 address in the ${replace} variable
  sed -i &quot;s/${search}/${replace}/g&quot; .dev.config.json
  exec /main &quot;$@&quot;
fi

</code></pre>

<blockquote>
<p>Note that the docker-entrypoint.sh script assumes the ipv4 address should be read
from the eth0 interface.  This may not be the case in more complex deployments.</p>
</blockquote>

<p><br></br></p>

<h4 id="build-the-image">Build the Image</h4>

<p>Assuming the previous steps have been successful, it is now time to build the new Docker image.  Execute the following command from the <em>libappk8</em> root folder:</p>

<pre><code class="language-shell">
docker build -t libappk8 .

</code></pre>

<p>Running <em>docker build</em> as shown instructs Docker to construct an image called <em>libappk8</em> using the Dockerfile in the current working directory.  You should see output similar to:</p>

<pre><code class="language-shell">Aardvark:libappk8 stevem$ docker build -t libappk8 .
Sending build context to Docker daemon   14.4MB
Step 1/18 : FROM alpine:3.7
 ---&gt; 3fd9065eaf02
Step 2/18 : LABEL maintainer=&quot;&lt;stevem@1414c.io&gt;&quot;
 ---&gt; Using cache
 ---&gt; a89002eee29a
Step 3/18 : ADD main ./
 ---&gt; Using cache
 ---&gt; 8b9bc986eeaf
Step 4/18 : RUN /bin/chmod 755 main
 ---&gt; Using cache
 ---&gt; 28d71ce7dab5
Step 5/18 : COPY .dev.config.json .
 ---&gt; 8e328fa89f48
Step 6/18 : ADD docker-entrypoint.sh .
 ---&gt; 03cdb6d936c9
Step 7/18 : RUN /bin/chmod 777 docker-entrypoint.sh
 ---&gt; Running in 531609e3a043
Removing intermediate container 531609e3a043
 ---&gt; 8ec421877ec1
Step 8/18 : RUN mkdir jwtkeys
 ---&gt; Running in b27591bd3191
Removing intermediate container b27591bd3191
 ---&gt; 4e55e01097c9
Step 9/18 : COPY jwtkeys ./jwtkeys
 ---&gt; e211c1e1ccee
Step 10/18 : ENV PORT 8080
 ---&gt; Running in fa89a88ebcf4
Removing intermediate container fa89a88ebcf4
 ---&gt; 416f504d58e1
Step 11/18 : EXPOSE 8080
 ---&gt; Running in 66c2aef3a443
Removing intermediate container 66c2aef3a443
 ---&gt; 6f3157466a72
Step 12/18 : EXPOSE 4444
 ---&gt; Running in 673d4bbef1f1
Removing intermediate container 673d4bbef1f1
 ---&gt; ac7734dd11c3
Step 13/18 : RUN apk update
 ---&gt; Running in 7e3b73167c88
fetch http://dl-cdn.alpinelinux.org/alpine/v3.7/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.7/community/x86_64/APKINDEX.tar.gz
v3.7.0-215-g16971064c0 [http://dl-cdn.alpinelinux.org/alpine/v3.7/main]
v3.7.0-207-gac61833f9b [http://dl-cdn.alpinelinux.org/alpine/v3.7/community]
OK: 9054 distinct packages available
Removing intermediate container 7e3b73167c88
 ---&gt; 367ea4588fb7
Step 14/18 : RUN apk add file
 ---&gt; Running in 785efc041757
(1/2) Installing libmagic (5.32-r0)
(2/2) Installing file (5.32-r0)
Executing busybox-1.27.2-r7.trigger
OK: 9 MiB in 13 packages
Removing intermediate container 785efc041757
 ---&gt; fdd43aa7687f
Step 15/18 : RUN apk add openssh-client
 ---&gt; Running in 324ae2c9b8c3
(1/2) Installing openssh-keygen (7.5_p1-r8)
(2/2) Installing openssh-client (7.5_p1-r8)
Executing busybox-1.27.2-r7.trigger
OK: 12 MiB in 15 packages
Removing intermediate container 324ae2c9b8c3
 ---&gt; 583336db3bff
Step 16/18 : RUN apk add postgresql-client
 ---&gt; Running in 5c16c83775fc
(1/9) Installing ncurses-terminfo-base (6.0_p20171125-r0)
(2/9) Installing ncurses-terminfo (6.0_p20171125-r0)
(3/9) Installing ncurses-libs (6.0_p20171125-r0)
(4/9) Installing libedit (20170329.3.1-r3)
(5/9) Installing db (5.3.28-r0)
(6/9) Installing libsasl (2.1.26-r11)
(7/9) Installing libldap (2.4.45-r3)
(8/9) Installing libpq (10.4-r0)
(9/9) Installing postgresql-client (10.4-r0)
Executing busybox-1.27.2-r7.trigger
OK: 24 MiB in 24 packages
Removing intermediate container 5c16c83775fc
 ---&gt; 73960ab81e46
Step 17/18 : ENTRYPOINT [&quot;/docker-entrypoint.sh&quot;]
 ---&gt; Running in 90236136ec8c
Removing intermediate container 90236136ec8c
 ---&gt; 960766571b87
Step 18/18 : CMD [&quot;-dev&quot;]
 ---&gt; Running in 60e5203ffd61
Removing intermediate container 60e5203ffd61
 ---&gt; c952825021e9
Successfully built c952825021e9
Successfully tagged libappk8:latest
Aardvark:pgelibraryapp stevem$

</code></pre>

<h5 id="view-the-image">View the Image</h5>

<p>You can run the <em>docker image</em> command as shown below to view some basic data regarding the new image:</p>

<pre><code class="language-shell">
  docker image ls libappk8

</code></pre>

<p>You should see output similar to:</p>

<pre><code class="language-shell">
 REPOSITORY          TAG                 IMAGE ID            CREATED                  SIZE
 libappk8            latest              c952825021e9        Less than a second ago   48.8MB

</code></pre>

<h5 id="use-the-image">Use the Image</h5>

<p>Once the image has been created, the next step is to use it to create a container.  This can be done in a single step where Docker creates the container and then starts it.  Run the following command to create and start a new container from the <em>libappk8</em> image:</p>

<pre><code class="language-shell">
  docker run --rm --name libappk8 -p 8080:8080 -d libappk8

</code></pre>

<p>Calling <em>docker run</em> with the <em>&ndash;rm</em> flag instructs Docker to delete the container when it is stopped.  Jiffy application containers should be considered throwaway under normal operating conditions.  Execution of <em>docker run</em> should create, start and detach the <em>libappk8</em> container.</p>

<p>If all went well, docker created a container from the <em>libappk8</em> image and then started it.  The flags provided with the <em>docker run</em> command do the following:</p>

<ul>
<li>&ndash;rm - remove (delete) the container after it is stopped</li>
<li>&ndash;name - the image to create the container from</li>
<li>-p - used to bind the host&rsquo;s tcp/8080 port to container port tcp/8080</li>
<li>-d - detach the container from the starting session</li>
</ul>

<h5 id="check-the-container-status">Check the Container Status</h5>

<p>Container status can be checked via the <em>docker ps</em> command:</p>

<pre><code class="language-shell">
  docker ps -a

</code></pre>

<p>Resulting in output similar to:</p>

<pre><code class="language-shell">
CONTAINER ID        IMAGE               COMMAND                  CREATED                  STATUS                    PORTS                              NAMES
7d99554e46dd        libappk8            &quot;/docker-entrypoint.…&quot;   Less than a second ago   Up 2 minutes              4444/tcp, 0.0.0.0:8080-&gt;8080/tcp   libappk8

</code></pre>

<p>The output of the command shows that the <em>libappk8</em> container was started with entrypoint &lsquo;/docker-entrypoint.sh -dev&rsquo; and that container port :8080 is mapped to host port :8080.</p>

<h5 id="ssh-into-the-container">SSH into the Container</h5>

<p>We can ssh into the running container to see what is going on using the command shown in the following terminal session.  The command logs in as root using the specified interactive shell (in this case /bin/sh).  Check that &lsquo;main -dev&rsquo; is running as expected using the Linux <em>ps</em> command.</p>

<pre><code class="language-shell">
  docker exec -it libappk8 /bin/sh

</code></pre>

<p>ps -ef shows that &lsquo;main -dev&rsquo; is running:</p>

<pre><code class="language-shell">
  / # ps -ef
  PID   USER     TIME   COMMAND
      1 root       0:00 /main -dev
     22 root       0:00 /bin/sh
     30 root       0:00 ps -ef
  / #

</code></pre>

<p>Take a look around the in the container environment and verify that the content of <em>.dev.config.json</em> has been updated with the correct ip-address using the <em>ifconfig/cat</em> commands.  Remember that in this use-case the docker container is created with a static ipv4 address assigned to the eth0 interface.  Verify that the eth0 ipv4 address has been added to the &lsquo;external_address&rsquo; and &lsquo;internal_address&rsquo; keys in <em>.dev.config.json</em>.</p>

<pre><code class="language-sh">
/ # ifconfig
eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:02
          inet addr:172.17.0.2  Bcast:172.17.255.255  Mask:255.255.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1173 errors:0 dropped:0 overruns:0 frame:0
          TX packets:887 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:117699 (114.9 KiB)  TX bytes:65147 (63.6 KiB)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:8058 errors:0 dropped:0 overruns:0 frame:0
          TX packets:8058 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1
          RX bytes:1409323 (1.3 MiB)  TX bytes:1409323 (1.3 MiB)

/ # cat .dev.config.json
{
    &quot;external_address&quot;: &quot;172.17.0.2:8080&quot;,
    &quot;internal_address&quot;: &quot;172.17.0.2:4444&quot;,
    &quot;env&quot;: &quot;dev&quot;,
    ...
    ...
    ...
            &quot;service_name&quot;:   &quot;Book&quot;,
            &quot;service_active&quot;: true
        }
        ]
}/ #

</code></pre>

<p><br></br></p>

<h4 id="use-the-psql-client-to-connect-to-postgres">Use the psql Client to Connect to Postgres</h4>

<p>We installed the Postgres client package into the <em>libappk8</em> image by including it in our Dockerfile.  Make sure that the <em>libappk8</em> container is running and that you have logged in via the <em>docker exec -it libappk8 /bin/sh</em> command.  Try to connect to your Postgres database as follows:</p>

<pre><code class="language-sh">
/ # psql -h 192.168.1.65 -d postgres -U postgres
Password for user postgres: *******************
psql (10.4, server 9.5.3)
Type &quot;help&quot; for help.

postgres=#

</code></pre>

<p>Connecting to the database using <em>psql</em> is just for demonstration purposes.  If the database was not reachable the container would not have started.  For a discussion of what to do if the container entrypoint fails, see the <a href="/jiffy/tutorials/using-docker/dr-content-g/">Troubleshooting</a> section of this document.
<br></br></p>

<h4 id="login-to-the-application">Login to the Application</h4>

<p>Launch Postman or your favorite RESTful service testing tool and specify a target URL of: <code>http://172.17.0.2:8080/usr/login</code> making sure to select the http POST method.  Maintain the request body to provide a user-id and password as shown in the following JSON snippet.  Typically the user-id for a Jiffy application is an email address, but an exception is made for the default administration user definition.</p>

<pre><code class="language-bash">
    {
        &quot;email&quot;: &quot;admin&quot;,
        &quot;password&quot;: &quot;initpass&quot;
    }

</code></pre>

<p><br/></p>

<p>When you have finished and your Postman (or other test utility) looks like the following image, click the &lsquo;Send&rsquo; button to post your login request to the running application.
<img src="../../images/login-a.jpg" alt="Enter login credentials" /></p>

<p><br/>
If all goes well, you will get a http response code of 200 (status ok), and a block of JSON with a single &lsquo;token&rsquo; tag containing a jumble of letters and numbers.  This is the JWT that will be used to validate the &lsquo;admin&rsquo; user&rsquo;s authorization to access the &lsquo;Library&rsquo; and &lsquo;Book&rsquo; entity service end-points.  If you want to read more about JWT&rsquo;s, <a href="https://jwt.io">jwt.io</a> is a good place to start, or you can refer to the <a href="/jiffy/accesscontrol/index.html">Access Control</a> section of this document set.
<img src="../../images/login-b.jpg" alt="Login" />
<br/></p>

<h4 id="create-a-library">Create a Library</h4>

<p>We will create a new &lsquo;Library&rsquo; entity.  Configure your test-tool to POST to the &lsquo;library&rsquo; service as shown in the following image:</p>

<p><img src="../../images/post_lib_1.jpg" alt="PostLib1" /></p>

<p>Copy the JWT from the login session and paste it into the new POST request&rsquo;s Authorization header field as shown below and then submit the request to the application.</p>

<p><img src="../../images/post_lib_2.jpg" alt="PostLib2" /></p>

<p>Following submission, a new &lsquo;Library&rsquo; entity should have been created:</p>

<p><img src="../../images/post_lib_3.jpg" alt="PostLib3" /></p>

<p><br></br></p>

<h4 id="stop-the-docker-container">Stop the Docker Container</h4>

<p>Now that we have verified that the containerized application runs in the Docker environment, stop the container as follows:</p>

<pre><code class="language-shell">
  docker stop libappk8

</code></pre>

<p><br></br></p>

<h3 id="install-minikube">Install Minikube</h3>

<p>Kubernetes offers a preconfigured single node cluster called <em>Minikube</em> which is designed to allow developers to test deployments.  <em>Minikube</em> is lightweight and will easily run on a workstation or laptop.  Install <em>Minikube</em> and <em>kubectl</em> following the instructions at <a href="https://kubernetes.io/docs/tasks/tools/install-minikube/">install-minikube</a>.  <em>Minikube</em> and <em>kubectl</em> are required in order to follow along with the tutorial.</p>

<p><br></br></p>

<h4 id="verify-minikube-installation">Verify Minikube Installation</h4>

<p>Once you have installed <em>minikube</em> and <em>kubectl</em> the cluster must be started and <em>kubectl</em> needs to be told to use the <em>minikube</em> context.  From the command-prompt run the following commands:</p>

<pre><code class="language-shell">
  minikube start

</code></pre>

<pre><code class="language-shell">
  kubectl config use-context minikube
  kubectl cluster-info

</code></pre>

<p>If there are any errors, go back to the <a href="https://kubernetes.io/docs/tasks/tools/install-minikube/">install-minikube instructions</a> and work through the issues before continuing.  If all went well, you should see output similar to the following:</p>

<pre><code class="language-shell">
  Aardvark:libappk8 stevem$ kubectl cluster-info
  Kubernetes master is running at https://192.168.64.2:8443
  KubeDNS is running at https://192.168.64.2:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

  To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
  Aardvark:libappk8 stevem$

</code></pre>

<p><br></br></p>

<h4 id="open-the-kubernetes-dashboard">Open the Kubernetes Dashboard</h4>

<p>Use of the Kubernetes dashboard is not required, but it does make things easier to understand.  The tutorial will make use of and refer the dashboard from this point forward.  Run the following command to open the Kubernetes dashboard in your default browser:</p>

<pre><code class="language-shell">
  nminikube dashboard

</code></pre>

<p>The dashboard should open in your default browser as shown below.  Note that it can take some time for the dashboard to become available.  If your browser opens but is not able to connect to the dashboard, wait a bit and then refresh the browser session.  The dashboard will should become available after a short delay.</p>

<p><img src="/jiffy/tutorials/images/k8dashboard1.png" alt="k8dashboard1" /></p>

<p><br></br></p>

<h4 id="deploy-the-application-in-kubernetes">Deploy the Application in Kubernetes</h4>

<p>Now that the <em>minikube</em> cluster is running and the Kubernetes dashboard has been launched, it is time to deploy the <em>libappk8</em> application.  We will create a single instance deployment of the application using the <em>kubectl</em> command.  Kubernetes expects to pull images from an image repository, however in this example we will be working with a local image instead.  <em>kubectl</em> requires that locally pulled images conform to a `image_name:image_version&rsquo; where the version is not equal to &lsquo;latest&rsquo;.  For this reason, we will build a new image with version :v1.</p>

<p>Remove the existing <em>libappk8</em> image via the <em>docker image rm</em> command, then use <em>eval</em> to tell Docker to build a new image in the <em>Minikube</em> environment.  Finally run <em>docker build</em> to create a new image (libappk8:v1) for deployment:</p>

<p>See <a href="https://stackoverflow.com/questions/49639280/kubernetes-cannot-pull-image-from-private-docker-image-repository">this link</a> for a discussion of using local Docker images with <em>Minikube</em>.</p>

<pre><code class="language-shell">
  docker image rm libappk8*
  eval $(minikube docker-env)
  docker build -t libappk8:v1 .

</code></pre>

<p>Once the new Docker image has been created, run the following <em>kubectl</em> command to create a new single instance deployment called <em>libappk8</em>:</p>

<pre><code class="language-shell">
  kubectl run libappk8 --image=libappk8:v1 --replicas=1 --port=8080

</code></pre>

<p>Execution of the <em>kubectl run</em> command should result in the following:</p>

<pre><code class="language-shell">
Aardvark:libappk8 stevem$ kubectl run libappk8 --image=libappk8:v1 --replicas=1 --port=8080
deployment.apps &quot;libappk8&quot; created
Aardvark:libappk8 stevem$

</code></pre>

<p>Go to the dashboard session running in the browser and click on &lsquo;Overview&rsquo; in the menubar located on the left-side of the screen.  You should see that a new Deployment called &lsquo;libappk8&rsquo; has been created from image libappk8:v1.  The Deployment should be running a single Pod (application instance) and everything should be green.</p>

<p><img src="/jiffy/tutorials/images/k8dashboard2.png" alt="k8dashboard2" /></p>

<p><br></br></p>

<h4 id="check-the-pod-logs">Check the Pod Logs</h4>

<p>Now that the application has been deployed into the the <em>minikube</em> cluster and appears to be running we can use the dashboard to check the application logs being emitted from the container&rsquo;s stdout/stderr.  Jiffy runs in a verbose manner at the moment, so a quick check of the log output will provide a good indication of the application&rsquo;s real health.</p>

<p>Click on the &lsquo;Pods&rsquo; menu-item under the &lsquo;Workloads&rsquo; heading in the menubar on left-side of the dashboard screen.  As we have only deployed with a single-instance (replica) of the <em>libappk8</em> application, we should see a single Pod.  Click on the <em>logs</em> icon as shown below to view the Pod/container stdout/stderr output:</p>

<p><img src="/jiffy/tutorials/images/k8dashboard3.png" alt="k8dashboard3" /></p>

<p>Upon clicking the <em>logs</em> icon, the dashboard will show a snapshot of the current stdout/stderr output from the Pod.  Enable the log auto-refresh by clicking the <em>refresh</em> icon as shown below and verify that the application appears to be in good health.</p>

<p><img src="/jiffy/tutorials/images/k8dashboard4.png" alt="k8dashboard4" /></p>

<p><br></br></p>

<h4 id="scale-the-application-up">Scale the Application Up</h4>

<p>We deployed a single instance (replica) of the application into the <em>minikube</em> cluster resulting the creation of a Deployment containing a single Pod.  We can add application instances to the Deployment with a few clicks in the dashboard &lsquo;Deployments&rsquo; view.  Click on &lsquo;Deployments&rsquo; in the menubar located on the left-side of the Kubernetes dashboard screen to see the current <em>libappk8</em> deployment.  Select &lsquo;Scale&rsquo; from the &lsquo;Action&rsquo; drop-down on the right-hand-side of the <em>libappk8</em> deployment row:</p>

<p><img src="/jiffy/tutorials/images/k8dashboard5.png" alt="k8dashboard5" /></p>

<p>Increase the number of desired Pods from 1 to 4.  Each Pod will run a distinct instance of the containerized jiffy application.</p>

<p><img src="/jiffy/tutorials/images/k8dashboard6.png" alt="k8dashboard6" /></p>

<p>Notice that the number of Pods in the <em>libappk8</em> Deployment row has increased as requested and the number of running Pods climbs to <sup>4</sup>&frasl;<sub>4</sub> in a few seconds.  Click on &lsquo;Pods&rsquo; in the menubar located on the left-side of the dashboard to view the list of Pods:</p>

<p><img src="/jiffy/tutorials/images/k8dashboard8.png" alt="k8dashboard8" /></p>

<p>Examine the log of each Pod and ensure that the application instances running in the Pods can see each other.  This is important from a cache management perspective.  Remember that each jiffy application instance caches authorization related information to mitigate the need for database round-trips or network calls while processing a service request.</p>

<p>In order for each application instance&rsquo;s cache to remain current, any application instance that processes a successful update of authorization/access information must propagate the change to the other application instances in the group.  When viewing the Pod logs, you should see something like this:</p>

<p><img src="/jiffy/tutorials/images/k8dashboard9.png" alt="k8dashboard9" /></p>

<p>The &lsquo;UpdFromPing()&rsquo; lines contain information regarding the Ping source-Pod&rsquo;s view of the group.  Generally speaking, you can expect to see a &lsquo;UpdFromPing()&rsquo; line for each Pod in the Deployment and a set of &lsquo;UpdFromPing()&rsquo; records from each Pod in the Deployment.  ALIVE statuses are good, SUSPECT and FAILED statuses are not so good.</p>

<p><br></br></p>

<h4 id="expose-the-deployment-via-a-kubernetes-service">Expose the Deployment via a Kubernetes Service</h4>

<p>So far we have created and scaled a Deployment of the <em>libappk8</em> application, but we have yet to access any of the application services.  Before accessing the <em>libappk8</em> services, we need to expose the Deployment through the creation of a Kubernetes Service.  In order to expose the <em>libappk8</em> Deployment via a Kubernetes Service we will fall back to the command-line.</p>

<p><br></br></p>

<h5 id="get-deployments">Get Deployments</h5>

<p>First we will show how to examine the <em>libappk8</em> Pods and Deployment from the command-line:</p>

<pre><code class="language-shell">
  kubectl get deployments

</code></pre>

<p>Results in:</p>

<pre><code class="language-shell">
Aardvark:libappk8 stevem$ kubectl get deployments
NAME       DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
libappk8   4         4         4            4           50m
Aardvark:libappk8 stevem$

</code></pre>

<p><br></br></p>

<h5 id="get-pods">Get Pods</h5>

<p>Next we will show how examine the list of Pods in the <em>libappk8</em> Deployment from the command-line:</p>

<pre><code class="language-shell">
  kubectl get pods

</code></pre>

<p>Results in:</p>

<pre><code class="language-shell">
  Aardvark:libappk8 stevem$ kubectl get pods
  NAME                        READY     STATUS    RESTARTS   AGE
  libappk8-687c7484cb-5nwxq   1/1       Running   0          53m
  libappk8-687c7484cb-8hmtw   1/1       Running   0          42m
  libappk8-687c7484cb-hnksv   1/1       Running   0          42m
  libappk8-687c7484cb-pbntc   1/1       Running   0          42m
  Aardvark:libappk8 stevem$

</code></pre>

<p><br></br></p>

<h5 id="get-kubernetes-services">Get Kubernetes Services</h5>

<p>Next we will show how to examine the list of Kubernetes Services running on the <em>minikube</em> cluster.  Remember that we told <em>kubectl</em> which Kubernetes cluster to connect to in an earlier step (link).</p>

<pre><code class="language-shell">
  kubectl get services

</code></pre>

<p>Results in the following list of Kubernetes Services:</p>

<pre><code class="language-shell">
  Aardvark:libappk8 stevem$ kubectl get services
  NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
  kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   36d
  Aardvark:libappk8 stevem$

</code></pre>

<p>As you can see, the <em>libappk8</em> Deployment is not yet available as a service.</p>

<p><br></br></p>

<h5 id="create-a-service-for-the-libappk8-deployment">Create a Service for the <em>libappk8</em> Deployment</h5>

<p>We will now create a Kubernetes Service for the <em>libappk8</em> Deployment.  Creation of the service will allow us to expose the application end-points via the load-balance built into the Kubernetes stack.  There are several options for the <em>type</em> of service that will be exposed, but for single Node testing with <em>minikube</em> the &lsquo;LoadBalancer&rsquo; type works well.  Create a new service from the <em>libappk8</em> Deployment as follows:</p>

<pre><code class="language-shell">
  kubectl expose deployment libappk8 --type=LoadBalancer

</code></pre>

<p>Creation of the service should result in the following:</p>

<pre><code class="language-shell">
  Aardvark:libappk8 stevem$ kubectl expose deployment libappk8 --type=LoadBalancer
  service &quot;libappk8&quot; exposed
  Aardvark:libappk8 stevem$

</code></pre>

<p>Check that the service has been created and is running:</p>

<pre><code class="language-shell">
  kubectl get services

</code></pre>

<p>You should see a new line in the Services table with the correct name and TYPE.  In a productive scenario, configuration would have been done to allocate an EXTERNAL-IP to the new Service.  <em>Minikube</em> does not allocate an external address for exposed Kubernetes Services, but exposes them via a port on the Cluster&rsquo;s server address.</p>

<pre><code class="language-shell">
  Aardvark:libappk8 stevem$ kubectl get services
  NAME         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
  kubernetes   ClusterIP      10.96.0.1       &lt;none&gt;        443/TCP          36d
  libappk8     LoadBalancer   10.103.54.235   &lt;pending&gt;     8080:32700/TCP   1m
  Aardvark:libappk8 stevem$

</code></pre>

<p><br></br></p>

<h4 id="get-the-base-url-for-the-kubernetes-service">Get the Base URL for the Kubernetes Service</h4>

<p>There are a few ways to get the base-address of our new <em>libappk8</em> Kubernetes Service.</p>

<ol>
<li>From the command-prompt using the &ndash;url flag.</li>
<li>From the command-prompt using the Cluster config and Service port mapping information.</li>
<li>From the Kubernetes dashboard using the Node configuration and Service port mapping information.</li>
</ol>

<p><br></br></p>

<h5 id="get-the-service-base-url-from-the-command-prompt">Get the Service Base URL from the Command-Prompt</h5>

<pre><code class="language-shell">
  minikube service libappk8 --url

</code></pre>

<p>This command will return the base URL of the <em>libappk8</em> service:</p>

<pre><code class="language-shell">
  Aardvark:libappk8 stevem$ minikube service libappk8 --url
  http://192.168.64.2:32700
  Aardvark:libappk8 stevem$

</code></pre>

<p><br></br></p>

<h5 id="get-the-service-base-url-from-the-cluster-config-service-port-mapping">Get the Service Base URL from the Cluster Config / Service Port Mapping</h5>

<p>Another way to determine the base URL of the <em>libappk8</em> service is to inspect the Service -&gt; Node port mapping as well as the Cluster configuration.  If we look at the result from the <em>kubectl get services</em> command we can see that Service port tcp:8080 is mapped to Node port tcp:32700:</p>

<blockquote>
<p>libappk8     LoadBalancer   10.103.54.235   <pending>     <strong>8080:32700/TCP</strong>   1m</p>
</blockquote>

<p>All we need now is the ipv4 address that the LoadBalancer is using.  We retrieve this value by running the following command to review the cluster&rsquo;s configuration:</p>

<pre><code class="language-shell">
  kubectl config view

</code></pre>

<p>The result of which is:</p>

<pre><code class="language-shell">
Aardvark:libappk8 stevem$ kubectl config view
apiVersion: v1
clusters:
- cluster:
    certificate-authority: /Users/stevem/.minikube/ca.crt
    server: https://192.168.64.2:8443
  name: minikube
contexts:
- context:
    cluster: minikube
    user: minikube
  name: minikube
current-context: minikube
kind: Config
preferences: {}
users:
- name: minikube
  user:
    client-certificate: /Users/stevem/.minikube/client.crt
    client-key: /Users/stevem/.minikube/client.key
Aardvark:libappk8 stevem$

</code></pre>

<p>Take note of the &lsquo;server:&rsquo; key.  This tells us the InternalIP of the <em>minikube</em> Node (192.168.64.2).  The base address of our exposed Kubernetes Service is therefore 192.168.64.2:32700.</p>

<p><br></br></p>

<h5 id="get-the-service-base-url-from-the-kubernetes-dashboard">Get the Service Base URL from the Kubernetes Dashboard</h5>

<p>It is also possible to get this information via the Kubernetes dashboard.  Open the dashboard and click on &lsquo;Nodes&rsquo; in the menubar on the left-side of the dashboard screen.  Take note of the &lsquo;InternalIP&rsquo; value in the &lsquo;Addresses:&rsquo; key as shown below:</p>

<p><img src="/jiffy/tutorials/images/k8dashboard10.png" alt="k8dashboard10" /></p>

<p>Next, click on the &lsquo;Services&rsquo; in the menubar on the left-side of the dashboard screen and select the <em>libappk8</em> Kubernetes Service.  Take note of the &lsquo;Internal endpoints&rsquo;.  The LoadBalancer-type Service is mapped from tcp/8080 to Node port tcp/32700.  The base URL of the exposed <em>libappk8</em> Kubernetes Service is <a href="https://192.168.64.2:32700">https://192.168.64.2:32700</a>.</p>

<p><img src="/jiffy/tutorials/images/k8dashboard11.png" alt="k8dashboard11" /></p>

<p><br></br></p>

<h4 id="login-to-the-load-balanced-kubernetes-service">Login to the Load Balanced Kubernetes Service</h4>

<p>Launch Postman or your favorite RESTful service testing tool and specify a target URL of: <code>http://192.168.64.2:32700/usr/login</code> making sure to select the http POST method.  Maintain the request body to provide a user-id and password as shown in the following JSON snippet.  Typically the user-id for a Jiffy application is an email address, but an exception is made for the default administration user definition.</p>

<pre><code class="language-bash">
    {
        &quot;email&quot;: &quot;admin&quot;,
        &quot;password&quot;: &quot;initpass&quot;
    }

</code></pre>

<p><br/></p>

<p>When you have finished and your Postman session (or other test utility) looks like the following image, click the &lsquo;Send&rsquo; button to post your login request to the running application.
<img src="/jiffy/tutorials/images/k8login1.png" alt="k8login1" /></p>

<p><br/>
If all goes well, you will get a http response code of 200 (status ok), and a block of JSON with a single &lsquo;token&rsquo; tag containing a jumble of letters and numbers.  This is the JWT that will be used to validate the &lsquo;admin&rsquo; user&rsquo;s authorization to access the &lsquo;Library&rsquo; and &lsquo;Book&rsquo; entity service end-points.  If you want to read more about JWT&rsquo;s, <a href="https://jwt.io">jwt.io</a> is a good place to start, or you can refer to the <a href="/jiffy/accesscontrol/index.html">Access Control</a> section of this document set.
<img src="/jiffy/tutorials/images/k8login2.png" alt="k8login2" />
<br/></p>

<h4 id="create-a-library-1">Create a Library</h4>

<p>We will create a new &lsquo;Library&rsquo; entity.  Configure your test-tool to POST to the &lsquo;library&rsquo; service as shown in the following image:</p>

<p><img src="/jiffy/tutorials/images/k8library1.png" alt="k8library1" /></p>

<p>Copy the JWT from the login session and paste it into the new POST request&rsquo;s Authorization header field as shown below and then submit the request to the application.</p>

<p><img src="/jiffy/tutorials/images/k8library2.png" alt="k8library2" /></p>

<p>Following submission, a new &lsquo;Library&rsquo; entity should have been created:</p>

<p><img src="/jiffy/tutorials/images/k8library3.png" alt="k8library3" /></p>

<p><br></br></p>

<p>Create another &lsquo;Library&rsquo; entity using the &lsquo;Create a Library&rsquo; steps and then request a list of Library entities using the GET ../librarys end-point:</p>

<p><img src="../../images/get_libs_1.jpg" alt="GetLibs1" /></p>

<h4 id="create-a-book">Create a Book</h4>

<p>Next, we will create a &lsquo;Book&rsquo; entity and allocate it to &lsquo;Library&rsquo; 1.  Configure your test-tool to POST to the &lsquo;book&rsquo; service as shown in the following image:</p>

<p><img src="../../images/post_book_1.jpg" alt="PostBook1" /></p>

<p>Following the submission, a new &lsquo;Book&rsquo; entity should have been created:</p>

<p><img src="../../images/post_book_2.jpg" alt="PostBook2" /></p>

<p>Create a few more &lsquo;Book&rsquo; entities using the &lsquo;Create a Book&rsquo; steps and allocate them to your &lsquo;Library&rsquo; entities.  When you have finished, request a list of &lsquo;Book&rsquo; entities using the GET ../books end-point:</p>

<p><img src="../../images/get_books_1.jpg" alt="GetBooks1" /></p>

<h4 id="library-tobooks">Library toBooks</h4>

<p>Based on the &lsquo;hasMany&rsquo; relationship between the &lsquo;Library&rsquo; and &lsquo;Book&rsquo; entity&rsquo;s, we can get the number of &lsquo;Book&rsquo; entities belonging to &lsquo;Library&rsquo; 1 as follows:</p>

<p><img src="../../images/get_lib1_books_count.jpg" alt="GetLib1BooksCount" /></p>

<p>Remove the $count suffix from the URL to get the complete list of Book entities belonging to &lsquo;Library&rsquo; 1:</p>

<p><img src="../../images/get_lib1_tobooks_1.jpg" alt="GetLib1Books1" /></p>

<h4 id="book-tolibrary">Book toLibrary</h4>

<p>A reciprocal &lsquo;belongsTo&rsquo; relationship exists between the &lsquo;Book&rsquo; and &lsquo;Library&rsquo; entity definitions.  Select a &lsquo;Book&rsquo; entity and verify that the &lsquo;belongsTo&rsquo; relationship works as expected:</p>

<p><img src="../../images/get_book4_tolibrary.jpg" alt="GetBook4ToLibrary" /></p>

<p>Check the list of <a href="/jiffy/overview/ov-content-b/#filters-and-relationships">filters</a> and <a href="/jiffy/overview/ov-content-b/#commands">commands</a> along with the Library and Book models to see what can be appended to the the service end-points.  Try some things out.</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/jiffy/tutorials/using-docker/dr-content-b/" title="Jiffy with Docker and External PostgreSQL"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/jiffy/tutorials/using-docker/dr-content-g/" title="Troubleshooting" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/jiffy/js/clipboard.min.js?1530805896"></script>
    <script src="/jiffy/js/perfect-scrollbar.min.js?1530805896"></script>
    <script src="/jiffy/js/perfect-scrollbar.jquery.min.js?1530805896"></script>
    <script src="/jiffy/js/jquery.sticky.js?1530805896"></script>
    <script src="/jiffy/js/featherlight.min.js?1530805896"></script>
    <script src="/jiffy/js/html5shiv-printshiv.min.js?1530805896"></script>
    <script src="/jiffy/js/highlight.pack.js?1530805896"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/jiffy/js/modernizr.custom.71422.js?1530805896"></script>
    <script src="/jiffy/js/learn.js?1530805896"></script>
    <script src="/jiffy/js/hugo-learn.js?1530805896"></script>

    <link href="/jiffy/mermaid/mermaid.css?1530805896" type="text/css" rel="stylesheet" />
    <script src="/jiffy/mermaid/mermaid.js?1530805896"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

